
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#f8fafc" />
    <title>Quick Tracker</title>
    
    <script src="https://unpkg.com/react@18.3.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.10/babel.min.js"></script>

    <style>
      #root:empty::before {
        content: "";
        display: block;
        width: 24px;
        height: 24px;
        margin: 45vh auto 0;
        border: 2px solid #e2e8f0;
        border-top-color: #0f172a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      
      body {
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior-y: contain;
        background-color: #f8fafc;
        height: 100%;
      }
      
      .fade-in {
        animation: fadeIn 0.15s ease-out forwards;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.98); }
        to { opacity: 1; transform: scale(1); }
      }

      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Компактная высота записи */
      .tracker-item {
        height: 48px;
      }
      
      textarea {
        resize: none;
        overflow: hidden;
        line-height: 1.1;
      }

      .btn-move {
        padding: 2px;
      }
    </style>
  </head>
  <body class="antialiased text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef } = React;

      const TrackerItem = ({ record, index, total, onDelete, onUpdate, onMove }) => {
        const textRef = useRef(null);

        useEffect(() => {
          if (record.isNew && textRef.current) {
            textRef.current.focus();
            onUpdate(record.id, 'isNew', false);
          }
        }, []);

        return (
          <div className="bg-white border border-slate-200 rounded-lg px-2 py-1 flex items-center justify-between shadow-sm fade-in mb-1.5 tracker-item">
            {/* Кнопки перемещения (вертикальный блок) */}
            <div className="flex flex-col justify-center mr-1.5 shrink-0 h-full">
              <button 
                onClick={() => onMove(index, -1)}
                disabled={index === 0}
                className={`btn-move rounded transition-colors ${index === 0 ? 'text-slate-100' : 'text-slate-300 hover:text-slate-900 active:bg-slate-100'}`}
              >
                <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={4} d="M5 15l7-7 7 7" />
                </svg>
              </button>
              <button 
                onClick={() => onMove(index, 1)}
                disabled={index === total - 1}
                className={`btn-move rounded transition-colors ${index === total - 1 ? 'text-slate-100' : 'text-slate-300 hover:text-slate-900 active:bg-slate-100'}`}
              >
                <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={4} d="M19 9l-7 7-7-7" />
                </svg>
              </button>
            </div>

            {/* Описание: две строки текста очень мелким шрифтом */}
            <div className="flex-1 min-w-0 pr-1 h-full flex items-center">
              <textarea 
                ref={textRef}
                rows="2"
                value={record.description}
                onChange={(e) => onUpdate(record.id, 'description', e.target.value)}
                placeholder="Описание..."
                className="text-[9px] font-medium text-slate-600 bg-transparent border-none outline-none focus:ring-0 placeholder:text-slate-300 w-full p-0 m-0"
              />
            </div>

            {/* Три компактных инпута */}
            <div className="flex items-center gap-1 shrink-0">
              {['val1', 'val2', 'val3'].map((f) => (
                <input 
                  key={f}
                  type="text" 
                  inputMode="numeric"
                  maxLength="2"
                  value={record[f] || ''}
                  onChange={(e) => onUpdate(record.id, f, e.target.value.slice(0, 2))}
                  className="w-7 h-7 text-center border border-slate-100 rounded text-[11px] font-black focus:border-slate-400 focus:outline-none bg-slate-50 text-slate-700"
                  placeholder="-"
                />
              ))}
            </div>

            {/* Удаление */}
            <button 
              onClick={() => onDelete(record.id)}
              className="ml-1.5 text-slate-200 hover:text-red-400 p-1 transition-colors shrink-0"
            >
              <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        );
      };

      const App = () => {
        const [records, setRecords] = useState(() => {
          try {
            const saved = localStorage.getItem('inline_tracker_v3');
            return saved ? JSON.parse(saved) : [];
          } catch(e) { return []; }
        });

        useEffect(() => {
          localStorage.setItem('inline_tracker_v3', JSON.stringify(records));
        }, [records]);

        const addNewRecord = () => {
          const newRecord = {
            id: Date.now().toString(),
            description: '',
            val1: '',
            val2: '',
            val3: '',
            isNew: true
          };
          setRecords(prev => [...prev, newRecord]);
          
          setTimeout(() => {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
          }, 50);
        };

        const updateRecord = (id, field, value) => {
          setRecords(prev => prev.map(r => r.id === id ? { ...r, [field]: value } : r));
        };

        const deleteRecord = (id) => {
          if(confirm('Удалить?')) {
            setRecords(prev => prev.filter(r => r.id !== id));
          }
        };

        const moveRecord = (index, direction) => {
          const newIndex = index + direction;
          if (newIndex < 0 || newIndex >= records.length) return;
          
          const newRecords = [...records];
          const [movedItem] = newRecords.splice(index, 1);
          newRecords.splice(newIndex, 0, movedItem);
          setRecords(newRecords);
        };

        return (
          <div className="min-h-screen max-w-md mx-auto flex flex-col relative pb-20">
            <header className="px-4 pt-4 pb-1 sticky top-0 bg-slate-50/90 backdrop-blur-md z-10 flex justify-between items-end">
              <div>
                <h1 className="text-sm font-black text-slate-900 tracking-tighter uppercase leading-none">Compact Tracker</h1>
                <div className="h-0.5 w-4 bg-slate-900 rounded-full mt-0.5"></div>
              </div>
              <div className="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-0.5">
                CNT: {records.length}
              </div>
            </header>

            <main className="p-3 flex flex-col">
              {records.map((r, idx) => (
                <TrackerItem 
                  key={r.id} 
                  record={r} 
                  index={idx}
                  total={records.length}
                  onDelete={deleteRecord}
                  onUpdate={updateRecord}
                  onMove={moveRecord}
                />
              ))}
              
              {records.length === 0 && (
                <div className="py-12 text-center opacity-10">
                  <p className="font-bold text-[9px] uppercase tracking-widest">No entries</p>
                </div>
              )}
            </main>

            <div className="fixed bottom-6 left-0 right-0 flex justify-center pointer-events-none">
              <button 
                onClick={addNewRecord}
                className="w-11 h-11 bg-slate-900 text-white rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-all pointer-events-auto"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={4} d="M12 6v12m6-6H6" />
                </svg>
              </button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
