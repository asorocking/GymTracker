
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    
    <!-- Favicon & Icons -->
    <link rel="icon" type="image/webp" href="https://files.oaiusercontent.com/file-DAn2Wc6gC9fV9Uu2o8G18S?se=2025-01-29T16%3A32%3A08Z&sp=r&sv=2024-08-04&sr=b&rscc=max-age%3D604800%2C%20private%2C%20immutable%2C%20proxy-revalidate&rscd=attachment%3B%20filename%3D17f1a0ba-a11f-449e-b816-d3450917637f.webp&sig=G0wJ%2B/D8L9X/8wWOnN/VInpYvLpA6m%2BzU907hI9N9nU%3D" />
    <link rel="apple-touch-icon" href="https://files.oaiusercontent.com/file-DAn2Wc6gC9fV9Uu2o8G18S?se=2025-01-29T16%3A32%3A08Z&sp=r&sv=2024-08-04&sr=b&rscc=max-age%3D604800%2C%20private%2C%20immutable%2C%20proxy-revalidate&rscd=attachment%3B%20filename%3D17f1a0ba-a11f-449e-b816-d3450917637f.webp&sig=G0wJ%2B/D8L9X/8wWOnN/VInpYvLpA6m%2BzU907hI9N9nU%3D" />
    
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="TrackerPro" />
    
    <title>Tracker Pro</title>
    
    <script src="https://unpkg.com/react@18.3.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.10/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      #root:empty::before {
        content: "";
        display: block;
        width: 24px;
        height: 24px;
        margin: 45vh auto 0;
        border: 2px solid #e2e8f0;
        border-top-color: #0f172a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      
      body {
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior-y: contain;
        background-color: #f8fafc;
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }
      
      .fade-in {
        animation: fadeIn 0.2s ease-out forwards;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .tracker-item {
        position: relative;
        transition: box-shadow 0.2s ease, opacity 0.2s ease, height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, opacity;
      }
      
      .tracker-item.dragging {
        opacity: 0.1;
        box-shadow: none;
      }

      .drag-handle {
        cursor: grab;
        touch-action: none;
      }
      .drag-handle:active {
        cursor: grabbing;
      }
      
      textarea, input[type="text"], input[type="date"], input[type="time"] {
        appearance: none;
        -webkit-appearance: none;
      }

      textarea {
        resize: none !important;
      }

      .delete-btn-active {
        color: #ef4444 !important;
        background-color: #fef2f2;
        border-radius: 6px;
      }

      .action-button {
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
      }
      .action-button:active {
        transform: scale(0.92);
        filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
      }

      .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2000;
        padding: 12px 20px;
        border-radius: 99px;
        background: #0f172a;
        color: white;
        font-size: 13px;
        font-weight: 600;
        box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        pointer-events: none;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .toast.show {
        opacity: 1;
        top: 30px;
      }

      .nav-btn {
        @apply p-1 text-slate-500 hover:text-slate-900 transition-all active:scale-125;
      }

      .modal-backdrop {
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .suggestions-list {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(226, 232, 240, 1);
        border-radius: 14px;
        box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        max-height: 200px;
        overflow-y: auto;
        padding: 4px;
        animation: suggestionsIn 0.2s ease-out forwards;
      }

      @keyframes suggestionsIn {
        from { opacity: 0; transform: translateY(-4px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .suggestion-item {
        @apply px-3 py-2 text-[12px] font-bold text-slate-600 rounded-[10px] transition-all cursor-pointer;
        display: flex;
        align-items: center;
        margin-bottom: 2px;
      }
      
      .suggestion-item:active {
        @apply bg-slate-100 text-slate-900;
      }

      input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
      }
      input[type=range]:focus {
        outline: none;
      }
      input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 6px;
        cursor: pointer;
        background: #e2e8f0;
        border-radius: 3px;
      }
      input[type=range]::-webkit-slider-thumb {
        height: 18px;
        width: 18px;
        border-radius: 50%;
        background: #0f172a;
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -6px;
      }

      .color-picker-wrapper {
        position: relative;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 2px solid #e2e8f0;
        overflow: hidden;
      }
      .color-picker-wrapper input[type="color"] {
        position: absolute;
        top: -10px;
        left: -10px;
        width: 50px;
        height: 50px;
        cursor: pointer;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 22px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: #e2e8f0;
        transition: .4s;
        border-radius: 22px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 16px; width: 16px;
        left: 3px; bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #0f172a;
      }
      input:checked + .slider:before {
        transform: translateX(18px);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
      }
      .calendar-day-header {
        @apply text-[10px] font-black text-slate-400 uppercase text-center py-2;
      }
      .calendar-day-cell {
        @apply relative aspect-square flex items-center justify-center text-xs font-bold rounded-xl transition-all active:scale-90 cursor-pointer;
      }
      .calendar-day-trained::after {
        content: '';
        @apply absolute bottom-1.5 w-1 h-1 bg-emerald-500 rounded-full;
      }
      .calendar-day-scheduled {
        @apply border border-dashed border-slate-200;
      }
      .calendar-day-selected {
        @apply bg-slate-900 text-white shadow-lg z-10;
      }
      .calendar-day-today {
        @apply border-2 border-slate-900 text-slate-900;
      }
      .calendar-day-outside {
        @apply opacity-20;
      }

      .expanded-content {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-height: 0;
        opacity: 0;
      }
      .expanded-content.show {
        max-height: 500px;
        opacity: 1;
        padding-top: 8px;
        padding-bottom: 8px;
      }

      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </head>
  <body class="antialiased text-slate-900">
    <div id="root"></div>

    <script>
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registered'))
            .catch(err => console.error('SW error', err));
        });
      }

      // Handle PWA Install Prompt
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        // Broadcast that we can install
        window.dispatchEvent(new CustomEvent('pwa-can-install'));
      });

      window.addEventListener('appinstalled', (evt) => {
        console.log('App installed');
        deferredPrompt = null;
        window.dispatchEvent(new CustomEvent('pwa-installed'));
      });
    </script>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef, useMemo } = React;

      const i18n = {
        ru: {
          appName: "GymTracker",
          shopName: "ShopTracker",
          pressureName: "120/80",
          cookName: "Cook",
          weight: "–í–µ—Å",
          kg: "–∫–≥",
          stats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
          export: "–≠–∫—Å–ø–æ—Ä—Ç",
          import: "–ò–º–ø–æ—Ä—Ç",
          save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
          progress: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
          bodyWeight: "–í–µ—Å —Ç–µ–ª–∞",
          exerciseStats: "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
          selectExercise: "–í—ã–±—Ä–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ",
          noData: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö",
          close: "–ó–∞–∫—Ä—ã—Ç—å",
          recordPlaceholder: "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ...",
          weightPlaceholder: "–í–µ—Å",
          notesPlaceholder: "–ü–æ–º–µ—Ç–∫–∏...",
          shopPlaceholder: "–ö—É–ø–∏—Ç—å...",
          cookPlaceholder: "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞...",
          recipeContentPlaceholder: "–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏ —Å–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è...",
          cookSearchPlaceholder: "–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–∞...",
          savedToast: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ üíæ",
          errorToast: "–û—à–∏–±–∫–∞ ‚ö†Ô∏è",
          exportToast: "–≠–∫—Å–ø–æ—Ä—Ç üì§",
          importToast: "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ",
          addExercise: "–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ",
          addItem: "–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫",
          addPressure: "–ù–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ",
          addRecipe: "–ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç",
          repeatLast: "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—à–ª—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É",
          noPastData: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ü§∑‚Äç‚ôÇÔ∏è",
          copySuccess: "–ö–æ–ø–∏—è:",
          clearConfirm: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ?",
          clearBtn: "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏",
          clearedToast: "–û—á–∏—â–µ–Ω–æ üóëÔ∏è",
          settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
          language: "–Ø–∑—ã–∫",
          russian: "–†—É—Å—Å–∫–∏–π",
          english: "English",
          uiSettings: "–í–Ω–µ—à–Ω–∏–π –≤–∏–¥",
          uiSettingsGym: "–í–∏–¥: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",
          uiSettingsShop: "–í–∏–¥: –ú–∞–≥–∞–∑–∏–Ω",
          uiSettingsPressure: "–í–∏–¥: –î–∞–≤–ª–µ–Ω–∏–µ",
          uiSettingsCook: "–í–∏–¥: –†–µ—Ü–µ–ø—Ç—ã",
          itemHeight: "–í—ã—Å–æ—Ç–∞ –∑–∞–ø–∏—Å–∏",
          itemWidth: "–®–∏—Ä–∏–Ω–∞ –∑–∞–ø–∏—Å–∏",
          itemSpacing: "–ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏",
          colorHighlight: "–°–µ—Ç/–ê–∫—Ü–µ–Ω—Ç",
          colorCompleted: "–ì–æ—Ç–æ–≤–æ",
          weightColor: "–¶–≤–µ—Ç —à—Ä–∏—Ñ—Ç–∞ –≤–µ—Å–∞",
          fontSize: "–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞",
          lineCount: "–ß–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –≤ –∑–∞–ø–∏—Å–∏",
          modeSwitched: "–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ",
          exerciseLibrary: "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π",
          shopLibrary: "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤",
          cookLibrary: "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤",
          libraryEmpty: "–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø–∏—Å—å.",
          count: "—Ä–∞–∑",
          start: "–ù–∞—á–∞—Ç—å",
          finish: "–ó–∞–∫–æ–Ω—á–∏—Ç—å",
          resetToast: "–í—Ä–µ–º—è —Å–±—Ä–æ—à–µ–Ω–æ ‚è±Ô∏è",
          workoutTime: "–í—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
          listNameLabel: "–ù–∞–∑–≤–∞–Ω–∏–µ",
          defaultListName: "–ù–æ–≤—ã–π —Å–ø–∏—Å–æ–∫",
          deleteEmptyLists: "–û—á–∏—Å—Ç–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏",
          addItemToLibrary: "–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É",
          editItemPlaceholder: "–ù–∞–∑–≤–∞–Ω–∏–µ...",
          alreadyExists: "–£–∂–µ –≤ —Å–ø–∏—Å–∫–µ!",
          toastDurationLabel: "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å–µ–∫)",
          maxWorkoutTimeLabel: "–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (—á–∞—Å)",
          enableToastsLabel: "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
          deleteListConfirm: "–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –∏ –≤—Å–µ –µ–≥–æ –∑–∞–ø–∏—Å–∏?",
          listDeletedToast: "–°–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω üóëÔ∏è",
          tabGeneral: "–û–±—â–∏–µ",
          tabLibraryGym: "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
          tabLibraryShop: "–¢–æ–≤–∞—Ä—ã",
          tabLibraryCook: "–†–µ—Ü–µ–ø—Ç—ã",
          tabLists: "–°–ø–∏—Å–∫–∏",
          listManagement: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞–º–∏",
          dragToReorder: "–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏",
          renameListPlaceholder: "–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å...",
          enableSuggestionsLabel: "–ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏",
          upperLabel: "–í–µ—Ä—Ö–Ω–µ–µ",
          lowerLabel: "–ù–∏–∂–Ω–µ–µ",
          pulseLabel: "–ü—É–ª—å—Å",
          timeLabel: "–í—Ä–µ–º—è",
          dateLabel: "–î–∞—Ç–∞",
          commentPlaceholder: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...",
          calendarTitle: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫",
          installApp: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
          installedOk: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ",
          daysShort: ["–í—Å", "–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±"],
          months: ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"]
        },
        en: {
          appName: "GymTracker",
          shopName: "ShopTracker",
          pressureName: "120/80",
          cookName: "Cook",
          weight: "Weight",
          kg: "kg",
          stats: "Stats",
          export: "Export",
          import: "Import",
          save: "Save",
          progress: "Statistics",
          bodyWeight: "Body Weight",
          exerciseStats: "Exercises",
          selectExercise: "Select exercise",
          noData: "Not enough data",
          close: "Close",
          recordPlaceholder: "Exercise...",
          weightPlaceholder: "Wgt",
          notesPlaceholder: "Notes...",
          shopPlaceholder: "Buy...",
          cookPlaceholder: "Recipe title...",
          recipeContentPlaceholder: "Ingredients and instructions...",
          cookSearchPlaceholder: "Search recipe...",
          savedToast: "Saved üíæ",
          errorToast: "Error ‚ö†Ô∏è",
          exportToast: "Exported üì§",
          importToast: "Imported ‚úÖ",
          addExercise: "Add Exercise",
          addItem: "Add to List",
          addPressure: "New Measurement",
          addRecipe: "New Recipe",
          repeatLast: "Repeat last workout",
          noPastData: "No data ü§∑‚Äç‚ôÇÔ∏è",
          copySuccess: "Copied:",
          clearConfirm: "Confirm clear?",
          clearBtn: "Delete all records",
          clearedToast: "Cleared üóëÔ∏è",
          settings: "Settings",
          language: "Language",
          russian: "Russian",
          english: "English",
          uiSettings: "Appearance",
          uiSettingsGym: "UI: Gym Mode",
          uiSettingsShop: "UI: Shop Mode",
          uiSettingsPressure: "UI: 120/80 Mode",
          uiSettingsCook: "UI: Cook Mode",
          itemHeight: "Item Height",
          itemWidth: "Item Width",
          itemSpacing: "Item Spacing",
          colorHighlight: "Set Color",
          colorCompleted: "Done Color",
          weightColor: "Weight font color",
          fontSize: "Font Size",
          lineCount: "Number of Lines",
          modeSwitched: "Switched to ",
          exerciseLibrary: "Exercise Library",
          shopLibrary: "Shop Library",
          cookLibrary: "Recipe Library",
          libraryEmpty: "Library is empty. Add items.",
          count: "times",
          start: "Start",
          finish: "Finish",
          resetToast: "Timer reset ‚è±Ô∏è",
          workoutTime: "Workout Time",
          listNameLabel: "List Name",
          defaultListName: "New List",
          deleteEmptyLists: "Clear empty lists",
          addItemToLibrary: "Add to library",
          editItemPlaceholder: "Name...",
          alreadyExists: "Already exists!",
          toastDurationLabel: "Toast duration (sec)",
          maxWorkoutTimeLabel: "Workout time limit (hrs)",
          enableToastsLabel: "Show notifications",
          deleteListConfirm: "Delete this list and all its items?",
          listDeletedToast: "List deleted üóëÔ∏è",
          tabGeneral: "General",
          tabLibraryGym: "Exercises",
          tabLibraryShop: "Items",
          tabLibraryCook: "Recipes",
          tabLists: "Lists",
          listManagement: "Manage Lists",
          dragToReorder: "Drag to reorder",
          renameListPlaceholder: "Rename...",
          enableSuggestionsLabel: "Library suggestions",
          upperLabel: "Upper",
          lowerLabel: "Lower",
          pulseLabel: "Pulse",
          timeLabel: "Time",
          dateLabel: "Date",
          commentPlaceholder: "Comment...",
          calendarTitle: "Workout Calendar",
          installApp: "Install App",
          installedOk: "App installed",
          daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
          months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        }
      };

      const DB_NAME = 'TrackerDB';
      const STORE_RECORDS = 'records';
      const STORE_WEIGHTS = 'weights';
      const STORE_SESSIONS = 'sessions';
      const DB_VERSION = 4;

      const initDB = () => {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);
          request.onupgradeneeded = (e) => {
            const db = e.target.result;
            if (!db.objectStoreNames.contains(STORE_RECORDS)) {
              db.createObjectStore(STORE_RECORDS, { keyPath: 'id' });
            }
            if (!db.objectStoreNames.contains(STORE_WEIGHTS)) {
              db.createObjectStore(STORE_WEIGHTS, { keyPath: 'dateKey' });
            }
            if (!db.objectStoreNames.contains(STORE_SESSIONS)) {
              db.createObjectStore(STORE_SESSIONS, { keyPath: 'dateKey' });
            }
          };
          request.onsuccess = (e) => resolve(e.target.result);
          request.onerror = (e) => reject(e.target.error);
        });
      };

      const saveToDB = async (records) => {
        if (!records) return;
        const db = await initDB();
        const tx = db.transaction(STORE_RECORDS, 'readwrite');
        const store = tx.objectStore(STORE_RECORDS);
        
        return new Promise((resolve, reject) => {
          const clearReq = store.clear();
          clearReq.onsuccess = () => {
            if (records.length === 0) {
              resolve();
              return;
            }
            records.forEach((r, index) => {
              store.put({ ...r, sortOrder: index });
            });
            tx.oncomplete = () => resolve();
            tx.onerror = () => reject(tx.error);
          };
          clearReq.onerror = () => reject(clearReq.error);
        });
      };

      const loadFromDB = async () => {
        const db = await initDB();
        const tx = db.transaction(STORE_RECORDS, 'readonly');
        const store = tx.objectStore(STORE_RECORDS);
        return new Promise((resolve) => {
          const request = store.getAll();
          request.onsuccess = () => {
            const results = request.result || [];
            const sorted = results.sort((a, b) => (a.sortOrder ?? 0) - (b.sortOrder ?? 0));
            resolve(sorted);
          };
        });
      };

      const saveWeightToDB = async (dateKey, weight) => {
        const db = await initDB();
        const tx = db.transaction(STORE_WEIGHTS, 'readwrite');
        const store = tx.objectStore(STORE_WEIGHTS);
        return new Promise((resolve, reject) => {
          store.put({ dateKey, weight });
          tx.oncomplete = () => resolve();
          tx.onerror = () => reject(tx.error);
        });
      };

      const loadWeightsFromDB = async () => {
        const db = await initDB();
        const tx = db.transaction(STORE_WEIGHTS, 'readonly');
        const store = tx.objectStore(STORE_WEIGHTS);
        return new Promise((resolve) => {
          const request = store.getAll();
          request.onsuccess = () => {
            const weightsMap = {};
            request.result.forEach(item => { weightsMap[item.dateKey] = item.weight; });
            resolve(weightsMap);
          };
        });
      };

      const saveSessionToDB = async (dateKey, session) => {
        const db = await initDB();
        const tx = db.transaction(STORE_SESSIONS, 'readwrite');
        const store = tx.objectStore(STORE_SESSIONS);
        return new Promise((resolve, reject) => {
          store.put({ dateKey, ...session });
          tx.oncomplete = () => resolve();
          tx.onerror = () => reject(tx.error);
        });
      };

      const loadSessionsFromDB = async () => {
        const db = await initDB();
        const tx = db.transaction(STORE_SESSIONS, 'readonly');
        const store = tx.objectStore(STORE_SESSIONS);
        return new Promise((resolve) => {
          const request = store.getAll();
          request.onsuccess = () => {
            const sessionsMap = {};
            request.result.forEach(item => { 
                const { dateKey, ...rest } = item;
                sessionsMap[dateKey] = rest; 
            });
            resolve(sessionsMap);
          };
        });
      };

      const getDateKey = (date) => {
        const d = new Date(date);
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
      };

      const CalendarModal = ({ isOpen, onClose, selectedDate, setSelectedDate, records, t }) => {
        const [currentMonth, setCurrentMonth] = useState(new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1));
        
        if (!isOpen) return null;

        const trainedDates = useMemo(() => {
          const dates = new Set();
          records.forEach(r => {
            if (r.mode === 'gym' || !r.mode) {
              dates.add(r.dateKey);
            }
          });
          return dates;
        }, [records]);

        const daysInMonth = (month, year) => new Date(year, month + 1, 0).getDate();
        const firstDayOfMonth = (month, year) => new Date(year, month, 1).getDay();

        const changeMonth = (offset) => {
          setCurrentMonth(prev => new Date(prev.getFullYear(), prev.getMonth() + offset, 1));
        };

        const today = new Date();
        const todayKey = getDateKey(today);
        const selectedKey = getDateKey(selectedDate);

        const calendarDays = [];
        const month = currentMonth.getMonth();
        const year = currentMonth.getFullYear();
        const daysCount = daysInMonth(month, year);
        const startDay = firstDayOfMonth(month, year);

        // Previous month filler
        for (let i = startDay - 1; i >= 0; i--) {
          const prevMonth = new Date(year, month - 1, 1);
          const prevMonthDaysCount = daysInMonth(prevMonth.getMonth(), prevMonth.getFullYear());
          calendarDays.push({
            day: prevMonthDaysCount - i,
            month: month - 1,
            year: year,
            isOutside: true
          });
        }

        // Current month
        for (let i = 1; i <= daysCount; i++) {
          calendarDays.push({
            day: i,
            month: month,
            year: year,
            isOutside: false
          });
        }

        // Next month filler
        const remaining = 42 - calendarDays.length;
        for (let i = 1; i <= remaining; i++) {
          calendarDays.push({
            day: i,
            month: month + 1,
            year: year,
            isOutside: true
          });
        }

        const isScheduledDay = (d) => {
          const dayOfWeek = d.getDay();
          return [1, 3, 5].includes(dayOfWeek);
        };

        const handleDateClick = (d) => {
          const target = new Date(d.year, d.month, d.day);
          setSelectedDate(target);
          onClose();
        };

        return (
          <div className="fixed inset-0 z-[1200] flex items-center justify-center p-4 modal-backdrop fade-in">
            <div className="bg-white w-full max-w-sm rounded-3xl shadow-2xl overflow-hidden flex flex-col">
              <div className="px-6 pt-6 pb-2 flex justify-between items-center border-b border-slate-50">
                <h2 className="text-lg font-black text-slate-900 tracking-tight">{t.calendarTitle}</h2>
                <button onClick={onClose} className="p-2 -mr-2 text-slate-400">
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <button onClick={() => changeMonth(-1)} className="p-2 text-slate-400 hover:text-slate-900"><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M15 19l-7-7 7-7" /></svg></button>
                  <span className="text-sm font-black text-slate-800 uppercase tracking-widest">{t.months[month]} {year}</span>
                  <button onClick={() => changeMonth(1)} className="p-2 text-slate-400 hover:text-slate-900"><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M9 5l7 7-7 7" /></svg></button>
                </div>

                <div className="calendar-grid">
                  {t.daysShort.map(d => <div key={d} className="calendar-day-header">{d}</div>)}
                  {calendarDays.map((d, idx) => {
                    const dateObj = new Date(d.year, d.month, d.day);
                    const key = getDateKey(dateObj);
                    const isToday = key === todayKey;
                    const isSelected = key === selectedKey;
                    const isTrained = trainedDates.has(key);
                    const isFuture = dateObj > today;
                    const scheduled = isFuture && isScheduledDay(dateObj);
                    
                    return (
                      <div 
                        key={idx} 
                        onClick={() => handleDateClick(d)}
                        className={`calendar-day-cell 
                          ${d.isOutside ? 'calendar-day-outside' : ''} 
                          ${isSelected ? 'calendar-day-selected' : ''} 
                          ${isToday && !isSelected ? 'calendar-day-today' : ''}
                          ${isTrained ? 'calendar-day-trained' : ''}
                          ${scheduled ? 'calendar-day-scheduled' : ''}
                        `}
                      >
                        {d.day}
                      </div>
                    );
                  })}
                </div>
              </div>
              
              <div className="px-6 pb-6 pt-2">
                <button onClick={() => { setSelectedDate(new Date()); onClose(); }} className="w-full py-3 bg-slate-100 text-slate-900 font-bold rounded-xl active:scale-95 mb-2">{t.repeatLast.includes('–ø—Ä–æ—à–ª—É—é') ? '–°–µ–≥–æ–¥–Ω—è' : 'Today'}</button>
                <button onClick={onClose} className="w-full py-3 bg-slate-900 text-white font-bold rounded-xl active:scale-95">{t.close}</button>
              </div>
            </div>
          </div>
        );
      };

      const LibraryEditor = ({ items, onAdd, onDelete, onEdit, t, placeholder }) => {
        const [newItem, setNewItem] = useState('');
        
        const handleAdd = () => {
          if (!newItem.trim()) return;
          if (items.includes(newItem.trim())) {
             alert(t.alreadyExists);
             return;
          }
          onAdd(newItem.trim());
          setNewItem('');
        };

        return (
          <div className="flex flex-col gap-3">
            <div className="flex gap-2">
              <input 
                type="text" 
                value={newItem} 
                onChange={(e) => setNewItem(e.target.value)} 
                onKeyDown={(e) => e.key === 'Enter' && handleAdd()}
                placeholder={placeholder || t.addItemToLibrary} 
                className="flex-1 bg-white border border-slate-200 rounded-xl px-4 py-2 text-sm font-semibold focus:ring-2 focus:ring-slate-900 focus:outline-none" 
              />
              <button onClick={handleAdd} className="p-2.5 bg-slate-900 text-white rounded-xl active:scale-95 transition-transform">
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M12 6v12m6-6H6" /></svg>
              </button>
            </div>
            
            <div className="bg-slate-50 rounded-2xl border border-slate-100 overflow-hidden max-h-[300px] overflow-y-auto">
              {items.length > 0 ? (
                items.map((item, index) => (
                  <div key={index} className="flex items-center px-4 py-2.5 border-b border-slate-100 last:border-0 gap-3 group">
                    <input 
                      type="text" 
                      value={item} 
                      onChange={(e) => onEdit(index, e.target.value)}
                      className="flex-1 bg-transparent border-none outline-none text-sm font-bold text-slate-700 focus:text-slate-900 p-0"
                    />
                    <button onClick={() => onDelete(index)} className="p-1.5 text-slate-300 hover:text-red-500 transition-colors">
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                  </div>
                ))
              ) : (
                <div className="p-8 text-center text-xs font-bold text-slate-400 italic">
                  {t.libraryEmpty}
                </div>
              )}
            </div>
          </div>
        );
      };

      const SettingsModal = ({ 
        isOpen, onClose, language, setLanguage, uiSettings, setUiSettings, 
        activeMode, exerciseRegistry, setExerciseRegistry, shopRegistry, setShopRegistry, 
        cookRegistry, setCookRegistry,
        shopListRegistry, setShopListRegistry, onRenameShopList,
        clearRegistry, t 
      }) => {
        const [activeTab, setActiveTab] = useState('general');
        const [canInstall, setCanInstall] = useState(!!window.deferredPrompt);

        useEffect(() => {
          const handleCanInstall = () => setCanInstall(true);
          const handleInstalled = () => setCanInstall(false);
          window.addEventListener('pwa-can-install', handleCanInstall);
          window.addEventListener('pwa-installed', handleInstalled);
          return () => {
            window.removeEventListener('pwa-can-install', handleCanInstall);
            window.removeEventListener('pwa-installed', handleInstalled);
          };
        }, []);

        const handleInstall = async () => {
          if (!window.deferredPrompt) return;
          window.deferredPrompt.prompt();
          const { outcome } = await window.deferredPrompt.userChoice;
          console.log(`User response to the install prompt: ${outcome}`);
          window.deferredPrompt = null;
          setCanInstall(false);
        };

        if (!isOpen) return null;

        const currentUISettings = uiSettings[activeMode];

        const updateUI = (key, val) => {
          setUiSettings(prev => ({
            ...prev,
            [activeMode]: {
              ...prev[activeMode],
              [key]: val
            }
          }));
        };

        const getRegistryConfig = () => {
          if (active