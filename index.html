
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#f8fafc" />
    <title>Quick Tracker</title>
    
    <script src="https://unpkg.com/react@18.3.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.10/babel.min.js"></script>

    <style>
      #root:empty::before {
        content: "";
        display: block;
        width: 24px;
        height: 24px;
        margin: 45vh auto 0;
        border: 2px solid #e2e8f0;
        border-top-color: #0f172a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      
      body {
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior-y: contain;
        background-color: #f8fafc;
        height: 100%;
      }
      
      .fade-in {
        animation: fadeIn 0.15s ease-out forwards;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.98); }
        to { opacity: 1; transform: scale(1); }
      }

      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .tracker-item {
        height: 48px;
      }
      
      textarea {
        resize: none !important;
        overflow: hidden;
        line-height: 1.2;
        appearance: none;
        -webkit-appearance: none;
      }

      textarea::-webkit-resizer {
        display: none;
      }

      .move-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 20px;
        color: #cbd5e1;
        transition: color 0.2s;
      }
      .move-btn:active:not(:disabled) {
        color: #0f172a;
      }
      
      .delete-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 40px;
        color: #e2e8f0;
        transition: color 0.2s;
      }
      .delete-btn:active {
        color: #ef4444;
      }

      /* Дополнительная гарантия видимости над клавиатурой на некоторых устройствах */
      .fab-container {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 50;
      }
    </style>
  </head>
  <body class="antialiased text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef } = React;

      const TrackerItem = ({ record, index, total, onDelete, onUpdate, onMove }) => {
        const textRef = useRef(null);

        useEffect(() => {
          if (record.isNew && textRef.current) {
            textRef.current.focus();
            onUpdate(record.id, 'isNew', false);
          }
        }, []);

        return (
          <div className="bg-white border border-slate-200 rounded-lg pl-1 pr-1 flex items-center justify-between shadow-sm fade-in mb-1.5 tracker-item">
            
            {/* Кнопки перемещения */}
            <div className="flex flex-col shrink-0 mr-1">
              <button 
                onClick={() => onMove(index, -1)}
                disabled={index === 0}
                className={`move-btn ${index === 0 ? 'opacity-0 pointer-events-none' : ''}`}
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={4} d="M5 15l7-7 7 7" />
                </svg>
              </button>
              <button 
                onClick={() => onMove(index, 1)}
                disabled={index === total - 1}
                className={`move-btn ${index === total - 1 ? 'opacity-0 pointer-events-none' : ''}`}
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={4} d="M19 9l-7 7-7-7" />
                </svg>
              </button>
            </div>

            {/* Описание */}
            <div className="flex-1 min-w-0 pr-2 h-full flex items-center">
              <textarea 
                ref={textRef}
                rows="2"
                value={record.description}
                onChange={(e) => onUpdate(record.id, 'description', e.target.value)}
                placeholder="Запись..."
                className="text-[12px] font-medium text-slate-700 bg-transparent border-none outline-none focus:ring-0 placeholder:text-slate-300 w-full p-0 m-0 leading-tight"
              />
            </div>

            {/* Значения */}
            <div className="flex items-center gap-1 shrink-0">
              {['val1', 'val2', 'val3'].map((f) => (
                <input 
                  key={f}
                  type="text" 
                  inputMode="numeric"
                  maxLength="2"
                  value={record[f] || ''}
                  onChange={(e) => onUpdate(record.id, f, e.target.value.slice(0, 2))}
                  className="w-8 h-8 text-center border border-slate-100 rounded text-[13px] font-bold focus:border-slate-400 focus:outline-none bg-slate-50 text-slate-800"
                  placeholder="-"
                />
              ))}
            </div>

            {/* Удаление */}
            <button 
              onClick={() => onDelete(record.id)}
              className="delete-btn shrink-0"
              aria-label="Удалить"
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        );
      };

      const App = () => {
        const [records, setRecords] = useState(() => {
          try {
            const saved = localStorage.getItem('inline_tracker_v6');
            return saved ? JSON.parse(saved) : [];
          } catch(e) { return []; }
        });

        useEffect(() => {
          localStorage.setItem('inline_tracker_v6', JSON.stringify(records));
        }, [records]);

        const addNewRecord = () => {
          const newRecord = {
            id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            description: '',
            val1: '',
            val2: '',
            val3: '',
            isNew: true
          };
          setRecords(prev => [...prev, newRecord]);
          
          setTimeout(() => {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
          }, 50);
        };

        const updateRecord = (id, field, value) => {
          setRecords(prev => prev.map(r => r.id === id ? { ...r, [field]: value } : r));
        };

        const deleteRecord = (id) => {
          setRecords(prev => prev.filter(r => r.id !== id));
        };

        const moveRecord = (index, direction) => {
          const newIndex = index + direction;
          if (newIndex < 0 || newIndex >= records.length) return;
          
          const newRecords = [...records];
          const [movedItem] = newRecords.splice(index, 1);
          newRecords.splice(newIndex, 0, movedItem);
          setRecords(newRecords);
        };

        return (
          <div className="min-h-screen max-w-md mx-auto flex flex-col relative pb-32">
            <header className="px-5 pt-5 pb-2 sticky top-0 bg-slate-50/90 backdrop-blur-md z-10 flex justify-between items-end">
              <div>
                <h1 className="text-base font-black text-slate-900 tracking-tight uppercase leading-none">Tracker</h1>
                <div className="h-0.5 w-4 bg-slate-900 rounded-full mt-1"></div>
              </div>
              <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-0.5">
                Total: {records.length}
              </div>
            </header>

            <main className="p-4 flex flex-col">
              {records.map((r, idx) => (
                <TrackerItem 
                  key={r.id} 
                  record={r} 
                  index={idx}
                  total={records.length}
                  onDelete={deleteRecord}
                  onUpdate={updateRecord}
                  onMove={moveRecord}
                />
              ))}
              
              {records.length === 0 && (
                <div className="py-20 text-center opacity-10">
                  <p className="font-bold text-[10px] uppercase tracking-widest">List is empty</p>
                </div>
              )}
            </main>

            {/* Floating Action Button (+) */}
            <div className="fab-container">
              <button 
                onClick={addNewRecord}
                className="w-14 h-14 bg-slate-900 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-95 transition-all focus:outline-none"
              >
                <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M12 6v12m6-6H6" />
                </svg>
              </button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
